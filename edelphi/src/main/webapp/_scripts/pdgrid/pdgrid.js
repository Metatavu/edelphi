if((typeof fi)=="undefined"){var fi={}}if((typeof fi.metatavu)=="undefined"){fi.metatavu={}}if((typeof fi.metatavu.datagrid)=="undefined"){fi.metatavu.datagrid={}}var _dataGrids=new Hash();function getDataGridById(a){return _dataGrids.get(a)}function getDataGrids(){return _dataGrids.values()}DataGrid=Class.create({initialize:function(l,n){this._rowClickListener=this._onRowClick.bindAsEventListener(this);this._headerClickListener=this._onHeaderClick.bindAsEventListener(this);this._activeRows=new Hash();this._rowElements=new Hash();this._filters=new Array();this._headerRowContent=new Element("div",{className:"dataGridRowContent"});this._headerRow=new Element("div",{className:"dataGridHeaderRow"});this._headerRow.appendChild(this._headerRowContent);this._content=new Element("div",{className:"dataGridContent"});this._rowCount=new Element("input",{type:"hidden",name:n.id+".rowCount",value:0});var a="dataGrid";if(n.rowHoverEffect===true){a+=" dataGridRowHoverEffect"}this.domNode=new Element("div",{className:a});this.domNode.appendChild(this._headerRow);this.domNode.appendChild(this._content);this.domNode.appendChild(this._rowCount);this._headerCells=new Object();this._cellEditors=new Hash();l.appendChild(this.domNode);this._hasHeader=false;this.options=n;for(var j=0;j<n.columns.length;j++){var e=n.columns[j];this._hasHeader=this._hasHeader||!((e.header=="")||(!e.header));var m=undefined;if(e.headerimg){var c="dataGridHeaderCellImage";if(Object.isFunction(e.headerimg.onclick)){c=c+" dataGridHeaderCellImageButton"}m=new Element("img",{src:e.headerimg.imgsrc,title:e.headerimg.tooltip?e.headerimg.tooltip:"",className:c});if(Object.isFunction(e.headerimg.onclick)){m._headerOnClick=e.headerimg.onclick;m._columnIndex=j;Event.observe(m,"click",this._headerClickListener)}}else{m=new Element("div",{className:"dataGridHeaderCellText"}).update(e.header)}var h=new Element("div",{className:"dataGridHeaderCell",title:e.headerTooltip?e.headerTooltip:""});h.appendChild(m);this._clearColumnFiltersClickListener=this._onClearColumnFiltersClickListener.bindAsEventListener(this);var d=new Element("span",{className:"dataGridClearFilterButton"});d._column=j;h.appendChild(d);Event.observe(d,"click",this._clearColumnFiltersClickListener);if(e.sortAttributes){this._sortColumnClickListener=this._onSortColumnClick.bindAsEventListener(this);if(e.sortAttributes.sortAscending){var f=new Element("span",{className:"dataGridHeaderSortButton dataGridHeaderSortButtonAscending",title:e.sortAttributes.sortAscending.toolTip});f._sortAction=new e.sortAttributes.sortAscending.sortAction(j,"asc");h.appendChild(f);Event.observe(f,"click",this._sortColumnClickListener)}if(e.sortAttributes.sortDescending){var b=new Element("span",{className:"dataGridHeaderSortButton dataGridHeaderSortButtonDescending",title:e.sortAttributes.sortDescending.toolTip});b._sortAction=new e.sortAttributes.sortDescending.sortAction(j,"desc");h.appendChild(b);Event.observe(b,"click",this._sortColumnClickListener)}}var g="px";if(e.measurementUnit!=undefined){g=e.measurementUnit}if((e.left!=undefined)&&(e.left!=NaN)){h.setStyle({left:e.left+g})}if((e.right!=undefined)&&(e.right!=NaN)){h.setStyle({right:e.right+g})}if((e.width!=undefined)&&(e.width!=NaN)){h.setStyle({width:e.width+g})}this._headerCells[j]=h;this._headerRowContent.appendChild(h)}this._headerRow.setStyle({display:"none"});if(n.id){_dataGrids.set(n.id,this);document.fire("ix:dataGridAdd",{dataGridComponent:this});this.domNode.setAttribute("dataGridId",n.id)}this._contextMenuButtonClickListener=this._onContextMenuButtonClick.bindAsEventListener(this);this._contextMenuItemClickListener=this._onContextMenuItemClick.bindAsEventListener(this)},deinitialize:function(){try{this.detachFromDom();this.deleteAllRows();this.domNode.descendants().invoke("purge");this.domNode.purge();this.domNode.remove();this.removeAllListeners()}catch(a){}},getId:function(){return this.domNode.getAttribute("dataGridId")},addRow:function(a,b){return this._addRows([a],b)},addRows:function(c,b){this.detachFromDom();var a=this._addRows(c,b);this.reattachToDom();return a},_addRows:function(a,p){var n=this.getRowCount()-1;var x=new Array();var w=this.options.columns.length;for(var m=0,h=a.length;m<h;m++){n++;var c=a[m];if(c.length!=this.options.columns.length){throw new Error("Value array length ("+c.length+") != data grid columns length ("+this.options.columns.length+")")}var r=new Element("div",{className:"dataGridRowContent"});var f=new Element("div",{className:"dataGridRow"});f._rowNumber=n;f.appendChild(r);this._rowElements.set(n,f);if(this.options.rowClasses){for(var s=0,o=this.options.rowClasses.length;s<o;s++){f.addClassName(this.options.rowClasses[s])}}for(var s=0;s<w;s++){var d=this.options.columns[s];var y=this.options.id?this.options.id+"."+n+"."+(d.paramName?d.paramName:s):"";var b=new Element("div",{className:"dataGridCell"});b._column=s;var t={};var v=false;var g="px";if(d.measurementUnit!=undefined){g=d.measurementUnit}if((d.left!=undefined)&&(d.left!=NaN)){t.left=d.left+g;v=true}if((d.right!=undefined)&&(d.right!=NaN)){t.right=d.right+g;v=true}if((d.width!=undefined)&&(d.width!=NaN)){t.width=d.width+g;v=true}if(v){b.setStyle(t)}var e=this._createCellContentHandler(y,d,p);r.appendChild(b);var u=DataGridControllers.getController(d.dataType);u.attachContentHandler(this,b,e);u.setEditorValue(e,c[s]);if(this._hasHeader==true){this._headerRow.setStyle({display:""})}}this._setRowCount(this.getRowCount()+1);Event.observe(f,"click",this._rowClickListener);x.push(f)}for(var s=0,o=x.length;s<o;s++){this._content.appendChild(x[s]);var n=x[s]._rowNumber;this.fire("rowAdd",{dataGridComponent:this,row:n});for(var q=0;q<w;q++){this.fire("cellValueChange",{dataGridComponent:this,row:n,column:q,value:a[s][q]})}}return n},deleteRow:function(a){this._deleteRow(a);this._redoFilters();this._redoSort()},hideRow:function(a){var b=this.getRowElement(a);var c=b.visible();if(c&&this.fire("beforeRowVisibilityChange",{dataGridComponent:this,rows:[a],hidden:false})){b.hide();if(this.getVisibleRowCount()==0&&this._hasHeader==true&&this._filters.size()==0){this._headerRow.setStyle({display:"none"})}this.fire("afterRowVisibilityChange",{dataGridComponent:this,rows:[a],hidden:true})}},hideRows:function(c){var b=new Array();for(var d=0,a=c.length;d<a;d++){var e=this.getRowElement(c[d]);if(e.visible()){b.push(e)}}var f=b.length>0;if(f&&this.fire("beforeRowVisibilityChange",{dataGridComponent:this,rows:b,hidden:false})){this.detachFromDom();b.invoke("hide");this.reattachToDom();if(this.getVisibleRowCount()==0&&this._hasHeader==true&&this._filters.size()==0){this._headerRow.setStyle({display:"none"})}this.fire("afterRowVisibilityChange",{dataGridComponent:this,rows:c,hidden:true})}},showRow:function(a){var c=this.getRowElement(a);var b=!c.visible();if(b&&this.fire("beforeRowVisibilityChange",{dataGridComponent:this,rows:[a],hidden:true})){c.show();this._headerRow.setStyle({display:""});this.fire("afterRowVisibilityChange",{dataGridComponent:this,rows:[a],hidden:false})}},showAllRows:function(){var c=new Array();var b=new Array();for(var d=0,a=this.getRowCount();d<a;d++){var f=this.getRowElement(d);if(!f.visible()){c.push(d);b.push(f)}}var e=b.length>0;if(e&&this.fire("beforeRowVisibilityChange",{dataGridComponent:this,rows:c,hidden:true})){this.detachFromDom();b.invoke("show");this.reattachToDom();if(this.getVisibleRowCount()>0&&this._hasHeader==true){this._headerRow.setStyle({display:""})}this.fire("afterRowVisibilityChange",{dataGridComponent:this,rows:c,hidden:false})}},isRowVisible:function(a){return this.getRowElement(a).visible()},getVisibleRowCount:function(){var a=0;for(var c=0,b=this.getRowCount();c<b;c++){if(this.isRowVisible(c)){a++}}return a},getNamedColumnIndex:function(a){for(var b=0;b<this.options.columns.length;b++){var c=this.options.columns[b];if(c.paramName==a){return b}}return -1},deleteAllRows:function(){while(this.getRowCount()>0){this._deleteRow(this.getRowCount()-1)}this.clearFilters()},getCellEditor:function(b,a){return this._cellEditors.get(b+"."+a)},getCellValue:function(c,a){var b=this.getCellEditor(c,a);return DataGridControllers.getController(b._dataType).getEditorValue(b)},setCellValue:function(f,c,e){var d=this.getCellEditor(f,c);var a=DataGridControllers.getController(d._dataType);var b=a.getEditorValue(d);if(b!==e){a.setEditorValue(d,e);this.fire("cellValueChange",{dataGridComponent:this,row:f,column:c,value:e})}},copyCellValue:function(d,b,c){var a=this.getCellEditor(b,d);var e=this.getCellEditor(c,d);DataGridControllers.getController(e._dataType).copyCellValue(e,a)},disableCellEditor:function(c,a){var b=this.getCellEditor(c,a);return DataGridControllers.getController(b._dataType).disableEditor(b)},enableCellEditor:function(c,a){var b=this.getCellEditor(c,a);return DataGridControllers.getController(b._dataType).enableEditor(b)},hideCell:function(c,a){var b=this.getCellEditor(c,a);DataGridControllers.getController(b._dataType).hide(b)},showCell:function(c,a){var b=this.getCellEditor(c,a);DataGridControllers.getController(b._dataType).show(b)},isCellVisible:function(c,a){var b=this.getCellEditor(c,a);return DataGridControllers.getController(b._dataType).isVisible(b)},isCellDisabled:function(c,a){var b=this.getCellEditor(c,a);return DataGridControllers.getController(b._dataType).isDisabled(b)},preventCellSelection:function(c,a){var b=this.getCellEditor(c,a)},allowCellSelection:function(b,a){},getHeaderCell:function(a){return this._headerCells[a]},getColumnCount:function(){return this.options.columns.length},disableRow:function(b){for(var a=0;a<this.options.columns.length;a++){this.disableCellEditor(b,a)}},enableRow:function(b){for(var a=0;a<this.options.columns.length;a++){this.enableCellEditor(b,a)}},getRowCount:function(){return parseInt(this._rowCount.value)},isCellEditable:function(c,b){var a=this.getCellEditor(c,b);return a._editable},setCellEditable:function(e,d,b){var c=this.getCellEditor(e,d);var a=DataGridControllers.getController(c._dataType);if(a.getEditable(c)!=b){a.setEditable(c,b);this.fire("cellEditableChanged",{dataGridComponent:this,row:e,column:d,editable:b})}},setCellDataType:function(m,d,i){var f=this.getCellEditor(m,d);if(f._dataType!=i){var h=DataGridControllers.getController(f._dataType);var b=DataGridControllers.getController(i);var j=h.getEditorValue(f);var c=f._editable;var a=f._name;var g=f._columnDefinition;var d=this._getCellEditorColumn(f);var m=this._getCellEditorRow(f);var l=f._cell;h.detachContentHandler(f);h.destroyHandler(f);if(c){var f=b.buildEditor(a,g);b.attachContentHandler(this,l,f);b.setEditorValue(f,j)}else{var e=b.buildViewer(a,g);b.attachContentHandler(this,l,e);b.setEditorValue(e,j)}this.fire("cellDataTypeChanged",{dataGridComponent:this,row:m,column:d,dataType:i})}},focusCell:function(d,c){var b=this.getCellEditor(d,c);var a=DataGridControllers.getController(b._dataType);a.focus(b)},getCellDataType:function(c,b){var a=this.getCellEditor(c,b);return a._dataType},setActiveRows:function(b){while(this.getActiveRows().length>0){this.removeActiveRow(this.getActiveRows()[0])}for(var a=0;a<b.length;a++){this.addActiveRow(b[a])}},getActiveRows:function(){return this._activeRows.keys()},isActiveRow:function(a){return this._activeRows.get(a)==true},addActiveRow:function(a){this._activeRows.set(a,true);this.getRowElement(a).addClassName("ixActiveTableRow")},removeActiveRow:function(a){this._activeRows.unset(a);this.getRowElement(a).removeClassName("ixActiveTableRow")},getRowElement:function(a){return this._rowElements.get(a)},isDetachedFromDom:function(){return this._detached==true},detachFromDom:function(){if(!this.isDetachedFromDom()){if(this.fire("beforeDetachFromDom",{dataGridComponent:this})){this._detachedParent=this.domNode.parentNode;this._detachedNextSibling=this.domNode.next();this.domNode.remove();this._detached=true;this._detachedCount=0;this.fire("afterDetachFromDom",{dataGridComponent:this})}}this._detachedCount++},reattachToDom:function(){if(this.isDetachedFromDom()){this._detachedCount--;if(this._detachedCount==0){if(this.fire("beforeReattachToDom",{dataGridComponent:this})){if(this._detachedNextSibling){this._detachedParent.insertBefore(this.domNode,this._detachedNextSibling)}else{this._detachedParent.appendChild(this.domNode)}this._detachedParent=undefined;this._detachedNextSibling=undefined;this._detached=false;this.fire("afterReattachToDom",{dataGridComponent:this})}}}},addFilter:function(b){if(this.fire("beforeFiltering",{dataGridComponent:this})){this._filters.push(b);b.execute({dataGridComponent:this});if(Object.isFunction(b.getColumn)){var a=b.getColumn();if((a!=undefined)&&(a>=0)){var c=this._headerCells[a];if(c){c.addClassName("dataGridColumnHeaderFiltered")}}}this.fire("afterFiltering",{dataGridComponent:this})}},applyFilters:function(){this._redoFilters()},_redoFilters:function(){if(this.fire("beforeFiltering",{dataGridComponent:this})){this.detachFromDom();this.showAllRows();var a=this;this._filters.each(function(b){b.execute({dataGridComponent:a})});this.reattachToDom();this.fire("afterFiltering",{dataGridComponent:this})}},clearFilters:function(){if(this.fire("beforeFiltering",{dataGridComponent:this})){this._filters.clear();for(var b=0,a=this.options.columns.length;b<a;b++){this._headerCells[b].removeClassName("dataGridColumnHeaderFiltered")}this.showAllRows();this.fire("afterFiltering",{dataGridComponent:this})}},_clearColumnFilter:function(c){if(this.fire("beforeFiltering",{dataGridComponent:this})){for(var a=this._filters.size()-1;a>=0;a--){var b=this._filters[a];if(b.getColumn()===c){this._filters.splice(a,1)}}var d=this._headerCells[c];if(d){d.removeClassName("dataGridColumnHeaderFiltered")}this.fire("afterFiltering",{dataGridComponent:this})}},_setSortMethod:function(a){this._sortMethod=a;this._redoSort()},_redoSort:function(){if(this._sortMethod){var g=this._rowElements.values().clone();var e={dataGridComponent:this};for(var c=1,a=g.length;c<a;c++){var b=c;var f=g[b-1]._rowNumber;var d=g[b]._rowNumber;while((b>0)&&(this._sortMethod.compare(e,f,d)>0)){var h=g[b];g[b]=g[b-1];g[b-1]=h;b--;if(b>0){f=g[b-1]._rowNumber;d=g[b]._rowNumber}}}this.detachFromDom();for(var c=0,a=g.length;c<a;c++){this._content.appendChild(g[c])}this.reattachToDom()}},_deleteRow:function(e){this.fire("beforeRowDelete",{dataGridComponent:this,row:e});for(var j=e;j<(this.getRowCount()-1);j++){for(var a=0;a<this.options.columns.length;a++){var b=this.getCellEditor(j,a);var l=this.getCellEditor(j+1,a);DataGridControllers.getController(b._dataType)._copyState(b,l)}}var e=this.getRowCount()-1;var c=this._rowElements.get(e);for(var d=0,f=this.options.columns.length;d<f;d++){if(this.options.columns[d].contextMenu){var h=this._getCellEditorCell(this.getCellEditor(e,d));var g=h.down(".dataGridCellContextMenuButton");Event.stopObserving(g,"click",this._contextMenuButtonClickListener)}}c.remove();this._setRowCount(this.getRowCount()-1);this.fire("rowDelete",{dataGridComponent:this,row:e});if(this.getVisibleRowCount()==0&&this._hasHeader==true&&this._filters.size()==0){this._headerRow.setStyle({display:"none"})}},_getContextButtonCell:function(a){return $(a.parentNode.parentNode)},_getCellEditorCell:function(a){return $(a._cell)},_getCellEditorRow:function(a){return this._getCellRow(this._getCellEditorCell(a))},_getCellEditorColumn:function(a){return this._getCellColumn(this._getCellEditorCell(a))},_getCellRow:function(a){var c=$(a.parentNode);if(c){var b=$(c.parentNode);if(b){return b._rowNumber}}return -1},_getCellColumn:function(a){return a._column},changeId:function(b){var g=this.options.id;if(this.fire("dataGridIdChange",{oldId:g,newId:b})){this.options.id=b;_dataGrids.unset(g);_dataGrids.set(b,this);this._rowCount.name=b+".rowCount";this.domNode.setAttribute("dataGridId",b);for(var c=0;c<this.options.columns.length;c++){var e=this.options.columns[c];for(var f=0;f<this.getRowCount();f++){var d=this.getCellEditor(f,c);var a=b?b+"."+f+"."+(e.paramName?e.paramName:c):"";DataGridControllers.getController(d._dataType).changeParamName(d,a)}}}},_setRowCount:function(a){this._rowCount.value=a},_onRowClick:function(a){var b=Event.element(a);if(!b.hasClassName("dataGridRow")){b=b.up(".dataGridRow")}if(b){this.fire("rowClick",{dataGridComponent:this,row:b._rowNumber})}},_onHeaderClick:function(b){var a=Event.element(b);if(Object.isFunction(a._headerOnClick)){a._headerOnClick({dataGridComponent:this,columnIndex:a._columnIndex})}},_createCellContentHandler:function(b,d,c){var a=DataGridControllers.getController(d.dataType);var f=c||d.editable;if(a.getMode()==DataGridControllers.EDITMODE_NOT_EDITABLE){f=false}else{if(a.getMode()==DataGridControllers.EDITMODE_ONLY_EDITABLE){f=true}}if(f){var e=a.buildEditor(b,d);return e}else{var g=a.buildViewer(b,d);return g}},_setCellContentHandler:function(c,a,b){this._cellEditors.set(c+"."+a,b)},_unsetCellContentHandler:function(b,a){this._cellEditors.unset(b+"."+a)},_onClearColumnFiltersClickListener:function(b){var a=Event.element(b);if(a._column){this._clearColumnFilter(a._column);this._redoFilters()}},_onSortColumnClick:function(a){var b=Event.element(a);if(b._sortAction){this._setSortMethod(b._sortAction)}},_onContextMenuButtonClick:function(b){var m=Event.element(b);var o=this._getContextButtonCell(m);var p=this._getCellRow(o);var e=this._getCellColumn(o);var n=this.options.columns[e];if(n&&n.contextMenu){var f=new Element("div",{className:"dataGridCellContextMenu"});for(var h=0,d=n.contextMenu.length;h<d;h++){var a=n.contextMenu[h];var g=new Element("div");g._menuItem=a;if(!("-"===a.text)){g.addClassName("dataGridCellContextMenuItem");g.update(a.text);Event.observe(g,"click",this._contextMenuItemClickListener)}else{g.addClassName("dataGridCellContextMenuItemSpacer")}f.appendChild(g)}var j=this;var c=function(q){var l=Event.element(q);var i=l.hasClassName("dataGridCellContextMenu");if(!i){if(l.up(".dataGridCellContextMenu")){i=true}}if(!i){$$(".dataGridCellContextMenu").forEach(function(r){$(r).select(".dataGridCellContextMenuItem").forEach(function(s){if(!s.hasClassName("dataGridCellContextMenuItemSpacer")){Event.stopObserving(s,"click",j._contextMenuItemClickListener)}});$(r).remove()});Event.stopObserving(Prototype.Browser.IE?document:window,"mousemove",c)}};Event.observe(Prototype.Browser.IE?document:window,"mousemove",c);o.appendChild(f)}},_onContextMenuItemClick:function(e){var f=Event.element(e);var b=f.parentNode;var d=f._menuItem;var a=$(b.parentNode);var g=this._getCellRow(a);var c=this._getCellColumn(a);var h=this;b.select(".dataGridCellContextMenuItem").forEach(function(i){Event.stopObserving(i,"click",h._contextMenuItemClickListener)});b.remove();d.onclick.execute({dataGridComponent:this,row:g,column:c,menuItem:d})}});Object.extend(DataGrid.prototype,fni.events.FNIEventSupport);DataGridControllers={registerController:function(a){this._controllers.set(a.getDataType(),a)},getController:function(a){return this._controllers.get(a)},EDITMODE_EDITABLE:0,EDITMODE_NOT_EDITABLE:1,EDITMODE_ONLY_EDITABLE:2,_controllers:new Hash()};DataGridEditorController=Class.create({buildEditor:function(a,b){},buildViewer:function(a,b){},attachContentHandler:function(a,g,b){b._dataGrid=a;b._cell=g;if(b._columnDefinition.contextMenu){var h=new Element("div",{className:"dataGridCellContextMenuButtonContainer"});var e=new Element("span",{className:"dataGridCellContextMenuButton"});var d=new Element("div",{className:"dataGridCellEditorContainer"});g.addClassName("dataGridContextMenuCell");Event.observe(e,"click",a._contextMenuButtonClickListener);h.appendChild(e);d.appendChild(b);g.appendChild(d);g.appendChild(h)}else{g.appendChild(b)}var i=this.getEditorRow(b);var c=this.getEditorColumn(b);a._setCellContentHandler(i,c,b);if(b._columnDefinition.hidden==true){this.hide(b)}else{this.show(b)}var f=b._columnDefinition.selectable;if(f==false){this.setSelectable(b,false)}return b},detachContentHandler:function(e){var f=this.getEditorRow(e);var d=this.getEditorColumn(e);e._dataGrid._unsetCellContentHandler(f,d);e._dataGrid=undefined;var a=e._cell;var c=a.childElements();for(var b=c.length-1;b>=0;b--){var g=c[b];g.parentNode.removeChild(g)}},destroyHandler:function(a){a._editable=undefined;a._dataType=undefined;a._name=undefined;a._cell=undefined;a._columnDefinition=undefined;if(a._fieldValue){a.removeChild(a._fieldValue);a._fieldValue=undefined}if(a._fieldContent){a.removeChild(a._fieldContent);a._fieldContent=undefined}},getEditable:function(a){return a._editable},setEditable:function(f,d){if(f._editable==d){return f}if((this.getMode(f)==DataGridControllers.EDITMODE_ONLY_EDITABLE)&&(d==false)){return f}if((this.getMode(f)==DataGridControllers.EDITMODE_NOT_EDITABLE)&&(d==true)){return f}var c=f._dataGrid;var b=f._cell;var g=this.isVisible(f);var e=this.getEditorValue(f);this.detachContentHandler(f);var a=d==true?this.buildEditor(f._name,f._columnDefinition):this.buildViewer(f._name,f._columnDefinition);this.attachContentHandler(c,b,a);if(g){this.show(a)}else{this.hide(a)}this.setEditorValue(a,e);this.destroyHandler(f);return a},getEditorValue:function(a){},setEditorValue:function(b,a){},getDisplayValue:function(a){if(this.getEditable(a)!=true){return a._fieldContent.innerHTML}else{return this.getEditorValue(a)}},disableEditor:function(a){},enableEditor:function(a){},enableEditor:function(a){},isDisabled:function(a){},hide:function(a){a._cell.hide()},show:function(a){a._cell.show()},isVisible:function(a){return a._cell.visible()},setSelectable:function(b,a){if(a==true){b.onselectstart=undefined;b.unselectable="off";b.style.MozUserSelect="text"}else{b.onselectstart=function(){return false};b.unselectable="on";b.style.MozUserSelect="none"}},getMode:function(){},getDataType:function(){},changeParamName:function(b,a){if(b._editable){b.name=a}else{b._name=a;if(b._fieldValue){b._fieldValue.name=a}}},focus:function(a){Form.Element.focus(a)},getDataGridComponent:function(a){return a._dataGrid},getEditorRow:function(a){return a._dataGrid._getCellEditorRow(a)},getEditorColumn:function(a){return a._dataGrid._getCellEditorColumn(a)},_createEditorElement:function(j,b,g,d,h){var f=new Element(j,Object.extend(d||{},{className:"dataGridCellEditor"+(g?" "+g:"")}));if(h.editorClassNames){var a=h.editorClassNames.split(" ");for(var e=0,c=a.length;e<c;e++){f.addClassName(a[e])}}f._editable=true;f._dataType=this.getDataType();f._name=b;f._columnDefinition=h;return f},_createViewerElement:function(j,b,g,d,h){var f=new Element(j,Object.extend(d||{},{className:"dataGridCellViewer"+(g?" "+g:"")}));if(h.viewerClassNames){var a=h.viewerClassNames.split(" ");for(var e=0,c=a.length;e<c;e++){f.addClassName(a[e])}}f._editable=false;f._dataType=this.getDataType();f._name=b;f._columnDefinition=h;f._fieldValue=new Element("input",{type:"hidden",name:b});f._fieldContent=new Element("span");f.appendChild(f._fieldValue);f.appendChild(f._fieldContent);return f},_setViewerValue:function(c,b,a){if(b==undefined||b==null){c._fieldValue.value="";c._fieldContent.innerHTML=""}else{c._fieldValue.value=b;c._fieldContent.innerHTML=a?a:String(b).escapeHTML()}},_getViewerValue:function(a){return a._fieldValue.value},_fireValueChange:function(a,b){a._dataGrid.fire("cellValueChange",{dataGridComponent:a._dataGrid,fieldType:a._dataType,column:this.getEditorColumn(a),row:this.getEditorRow(a),value:b})},_addDisabledHiddenElement:function(c){if(c.parentNode){var b=this.getEditorValue(c);if(c._disabledHiddenElement){c._disabledHiddenElement.value=b}else{var a=new Element("input",{type:"hidden",value:b,name:c._name});c._disabledHiddenElement=a;c._cell.appendChild(a)}}else{}},_removeDisabledHiddenElement:function(a){if(a._disabledHiddenElement){a._disabledHiddenElement.remove();delete a._disabledHiddenElement}},_updateDisabledHiddenElement:function(b,a){if(b._disabledHiddenElement){b._disabledHiddenElement.value=a}},copyCellValue:function(b,a){this.setEditorValue(b,this.getEditorValue(a))},_copyState:function(b,a){this.copyCellValue(b,a);return this.setEditable(b,this.getEditable(a))},_unescapeHtmlEntities:function(b){if(b){var a=document.createElement("pre");a.innerHTML=b;b=a.firstChild.nodeValue}return b}});Object.extend(DataGridEditorController.prototype,fni.events.FNIEventSupport);ButtonTableEditorButtonController=Class.create(DataGridEditorController,{buildViewer:function($super,b,d){if(d.imgsrc){var f=new Element("img",{src:d.imgsrc,title:d.tooltip?d.tooltip:"",className:"dataGridCellViewer dataGridCellEditorButton"});if(d.viewerClassNames){var e=d.viewerClassNames.split(" ");for(var c=0,a=e.length;c<a;c++){f.addClassName(e[c])}}f._editable=false;f._dataType=this.getDataType();f._name=b;f._columnDefinition=d;return f}else{throw new Error("Unable to build button without image")}},attachContentHandler:function($super,b,a,c){var c=$super(b,a,c);c._clickListener=this._onClick.bindAsEventListener(this);Event.observe(c,"click",c._clickListener)},detachContentHandler:function($super,a){Event.stopObserving(a,"click",a._clickListener);a._clickListener=undefined;$super(a)},disableEditor:function($super,a){a._disabled=true;a.addClassName("dataGridButtonDisabled")},enableEditor:function($super,a){a._disabled=false;a.removeClassName("dataGridButtonDisabled")},destroyEditor:function($super,a){a.remove()},isDisabled:function($super,a){return a._disabled==true},getDataType:function($super){return"button"},getMode:function($super){return DataGridControllers.EDITMODE_NOT_EDITABLE},_onClick:function(a){var b=Event.element(a);if(Object.isFunction(b._columnDefinition.onclick)){Event.stop(a);if(this.isDisabled(b)!=true){b._columnDefinition.onclick.call(window,{dataGridComponent:b._dataGrid,row:this.getEditorRow(b),column:this.getEditorColumn(b)})}}}});DataGridControllers.registerController(new ButtonTableEditorButtonController());NumberDataGridEditorController=Class.create(DataGridEditorController,{buildEditor:function($super,a,b){var c=this._createEditorElement("input",a,"dataGridCellEditorNumber",{type:"text",name:a},b);c.addClassName("float");if(b.required){c.addClassName("required")}this._editorValueChangeListener=this._onEditorValueChange.bindAsEventListener(this);Event.observe(c,"change",this._editorValueChangeListener);return c},buildViewer:function($super,a,b){return this._createViewerElement("div",a,"dataGridCellViewerNumber",{},b)},disableEditor:function($super,a){if(a._editable==false){a.addClassName("dataGridCellViewerDisabled")}else{this._addDisabledHiddenElement(a);a.disabled=true}},enableEditor:function($super,a){if(a._editable==false){a.removeClassName("dataGridCellViewerDisabled")}else{a.disabled=false;this._removeDisabledHiddenElement(a)}},getEditorValue:function($super,a){if(a._editable!=true){return this._getViewerValue(a)}else{return a.value}},setEditorValue:function($super,b,a){if(b._editable!=true){this._setViewerValue(b,a)}else{if(this.isDisabled(b)){this._updateDisabledHiddenElement(b,a)}b.value=a}},destroyEditor:function($super,a){a.remove()},isDisabled:function($super,a){return a.disabled==true},getDataType:function(){return"number"},getMode:function(){return DataGridControllers.EDITMODE_EDITABLE},_onEditorValueChange:function(a){var b=Event.element(a);this._fireValueChange(b,b.value)}});DataGridControllers.registerController(new NumberDataGridEditorController());CheckboxDataGridEditorController=Class.create(DataGridEditorController,{buildEditor:function($super,a,b){var c=this._createEditorElement("input",a,"dataGridCellEditorCheckbox",{name:a,value:"1",type:"checkbox"},b);this._editorValueChangeListener=this._onEditorValueChange.bindAsEventListener(this);Event.observe(c,"change",this._editorValueChangeListener);return c},buildViewer:function($super,a,b){return this._createViewerElement("div",a,"dataGridCellViewerCheckbox",{},b)},disableEditor:function($super,a){if(a._editable!=true){a.addClassName("dataGridCellViewerDisabled")}else{this._addDisabledHiddenElement(a);a.disabled=true}},enableEditor:function($super,a){if(a._editable!=true){a.removeClassName("dataGridCellViewerDisabled")}else{a.disabled=false;this._removeDisabledHiddenElement(a)}},getEditorValue:function($super,a){if(a._editable!=true){return this._getViewerValue(a)==1}else{return a.checked}},setEditorValue:function($super,b,a){var c;if(Object.isString(a)){c=a=="1"}else{if(Object.isNumber(a)){c=a==1}else{c=a}}if(b._editable!=true){this._setViewerValue(b,c?1:0,'<div class="dataGridViewerCheckbox'+(c?"Checked":"NotChecked")+'"/>')}else{if(this.isDisabled(b)){this._updateDisabledHiddenElement(b,c?1:0)}b.checked=c}},destroyEditor:function($super,a){a.remove()},isDisabled:function($super,a){return a.disabled==true},getDataType:function($super){return"checkbox"},getMode:function($super){return DataGridControllers.EDITMODE_EDITABLE},_onEditorValueChange:function(a){var b=Event.element(a);this._fireValueChange(b,b.value)}});DataGridControllers.registerController(new CheckboxDataGridEditorController());RadioButtonDataGridEditorController=Class.create(DataGridEditorController,{buildEditor:function($super,a,b){var c=this._createEditorElement("input",a,"dataGridCellEditorCheckbox",{name:a,value:"true",type:"radio",title:b.tooltip?b.tooltip:""},b);this._editorValueChangeListener=this._onEditorValueChange.bindAsEventListener(this);Event.observe(c,"change",this._editorValueChangeListener);return c},buildViewer:function($super,a,b){return this._createViewerElement("div",a,"dataGridCellViewerCheckbox",{},b)},disableEditor:function($super,a){if(a._editable!=true){a.addClassName("dataGridCellViewerDisabled")}else{this._addDisabledHiddenElement(a);a.disabled=true}},enableEditor:function($super,a){if(a._editable!=true){a.removeClassName("dataGridCellViewerDisabled")}else{a.disabled=false;this._removeDisabledHiddenElement(a)}},getEditorValue:function($super,a){if(a._editable!=true){return this._getViewerValue(a)==1}else{return a.checked}},setEditorValue:function($super,b,a){var c;if(Object.isString(a)){c=a=="1"}else{if(Object.isNumber(a)){c=a==1}else{c=a}}if(b._editable!=true){this._setViewerValue(b,c?1:0,'<div class="dataGridViewerCheckbox'+(c?"Checked":"NotChecked")+'"/>')}else{if(this.isDisabled(b)){this._updateDisabledHiddenElement(b,c?1:0)}b.checked=c}},destroyEditor:function($super,a){a.remove()},isDisabled:function($super,a){return a.disabled==true},getDataType:function($super){return"radiobutton"},getMode:function($super){return DataGridControllers.EDITMODE_EDITABLE},_onEditorValueChange:function(d){var f=Event.element(d);var g=this.getEditorRow(f);var b=this.getEditorColumn(f);if(this.getEditorValue(f)){var c=f._dataGrid;var e=c.getRowCount();for(var a=0;a<e;a++){if(a!=g){if((c.getCellDataType(a,b)=="radiobutton")&&(c.isCellEditable(a,b))){c.setCellValue(a,b,false)}}}}this._fireValueChange(f,f.value)}});DataGridControllers.registerController(new RadioButtonDataGridEditorController());SelectDataGridEditorController=Class.create(DataGridEditorController,{buildEditor:function($super,a,b){var c=this._createEditorElement("select",a,"dataGridCellEditorSelect",{name:a},b);if(b.required){c.addClassName("required")}this._editorValueChangeListener=this._onEditorValueChange.bindAsEventListener(this);if(b.options){this._addOptionsFromArray(c,b.options)}return c},removeAllOptions:function(b){if(b._editable){for(var a=b.options.length-1;a>=0;a--){$(b.options[a]).remove()}}},addOption:function(b,a,c){return this.addOption(b,a,c,false)},addOption:function(d,c,e,a){if(d._editable){var b=this._createOption(c,e,a);d.appendChild(b);return b}else{d._options.push({text:e,value:c});if(this.getEditorValue(d)==c){this._setViewerValue(d,c,e)}}},_createOptionGroup:function(a){return new Element("optgroup",{label:a})},_createOption:function(c,d,a){var b;if(!a){b=new Element("option",{value:c===undefined?"":c})}else{b=new Element("option",{value:c===undefined?"":c,selected:"selected"})}if(d){b.update(d)}return b},attachContentHandler:function($super,c,b,d){var a=$super(c,b,d);if(this.getEditable(d)){Event.observe(a,"change",this._editorValueChangeListener)}return a},detachContentHandler:function($super,a){if(this.getEditable(a)){Event.stopObserving(a,"change",this._editorValueChangeListener)}$super(a)},buildViewer:function($super,a,b){var c=this._createViewerElement("div",a,"dataGridCellViewerSelect",{},b);if(this.isDynamicOptions(c)){c._options=new Array()}return c},disableEditor:function($super,a){if(a._editable!=true){a.addClassName("dataGridCellViewerDisabled")}else{this._addDisabledHiddenElement(a);a.disabled=true}},enableEditor:function($super,a){if(a._editable!=true){a.removeClassName("dataGridCellViewerDisabled")}else{a.disabled=false;this._removeDisabledHiddenElement(a)}},getEditorValue:function($super,a){if(a._editable!=true){return this._getViewerValue(a)}else{return a.value}},getDisplayValue:function($super,c){if(c._editable!=true){return $super(c)}else{var a=c.selectedIndex;var b=c.options[a];if(b){return b.innerHTML}else{return $super(c)}}},setEditorValue:function($super,f,e){if(f._editable!=true){var d=e;var b=this.isDynamicOptions(f)?f._options:f._columnDefinition.options;if(b){for(var c=0;c<b.length;c++){if(b[c].optionGroup==true){for(var a=0;a<b[c].options.length;a++){if(b[c].options[a].value==e){d=b[c].options[a].text;break}}}else{if(b[c].value==e){d=b[c].text;break}}}}this._setViewerValue(f,e,d)}else{if(this.isDisabled(f)){this._updateDisabledHiddenElement(f,e)}f.value=e}},destroyEditor:function($super,a){a.remove()},isDisabled:function($super,a){return a.disabled==true},isDynamicOptions:function(a){return a._columnDefinition.dynamicOptions||false},getDataType:function($super){return"select"},getMode:function($super){return DataGridControllers.EDITMODE_EDITABLE},getOptions:function(a){if(this.getEditable(a)){return this._readOptionsToArray(a)}else{return a._options}},setOptions:function(b,a){if(this.getEditable(b)){this.removeAllOptions(b);this._addOptionsFromArray(b,a)}else{b._options=a}},_onEditorValueChange:function(a){var b=Event.element(a);this._fireValueChange(b,b.value)},setEditable:function($super,e,c){if(this.getEditable(e)==c){return e}if(!this.isDynamicOptions(e)){return $super(e,c)}var d=this.getEditorValue(e);var a;if(this.getEditable(e)){a=this._readOptionsToArray(e)}else{a=e._options}var b=$super(e,c);if(c){this._addOptionsFromArray(b,a)}else{b._options=a}this.setEditorValue(b,d);return b},copyCellValue:function($super,d,c){if(!this.isDynamicOptions(c)){$super(d,c)}else{var b=this.getEditorValue(c);var a;if(this.getEditable(c)){a=this._readOptionsToArray(c)}else{a=c._options}if(this.getEditable(d)){this.removeAllOptions(d);this._addOptionsFromArray(d,a)}else{d._options=a}this.setEditorValue(d,b)}},_addOptionsFromArray:function(e,o){var a=new Array();for(var f=0,d=o.length;f<d;f++){var h=o[f];if(h.optionGroup==true){var m=this._createOptionGroup(h.text);var b=h.options;for(var n=0;n<b.length;n++){var c=this._createOption(b[n].value,b[n].text,false);m.appendChild(c)}a.push(m)}else{a.push(this._createOption(h.value,h.text,false))}}for(var g=0,d=a.length;g<d;g++){e.appendChild(a[g])}},_readOptionsToArray:function(c){var l=new Array();for(var g=0,d=c.childNodes.length;g<d;g++){var f=c.childNodes[g];if(f.tagName=="OPTGROUP"){var a=new Array();for(var e=0,h=f.childNodes.length;e<h;e++){var b=f.childNodes[k];a.push({text:groupOptionNode.text,value:groupOptionNode.value})}l.push({text:f.text,optionGroup:true,options:a})}else{if(f.tagName=="OPTION"){l.push({text:f.text,value:f.value})}}}return l}});DataGridControllers.registerController(new SelectDataGridEditorController());TextDataGridEditorController=Class.create(DataGridEditorController,{buildEditor:function($super,a,b){var c=this._createEditorElement("input",a,"dataGridCellEditorText",{name:a,type:"text"},b);if(b.required){c.addClassName("required")}this._editorValueChangeListener=this._onEditorValueChange.bindAsEventListener(this);Event.observe(c,"change",this._editorValueChangeListener);return c},buildViewer:function($super,a,b){return this._createViewerElement("div",a,"dataGridCellViewerText",{},b)},attachContentHandler:function($super,b,a,c){var c=$super(b,a,c);c._clickListener=this._onClick.bindAsEventListener(this);Event.observe(c,"click",c._clickListener)},detachContentHandler:function($super,a){Event.stopObserving(a,"click",a._clickListener);a._clickListener=undefined;$super(a)},disableEditor:function($super,a){if(a._editable==false){a.addClassName("dataGridCellViewerDisabled")}else{this._addDisabledHiddenElement(a)}a.disabled=true},enableEditor:function($super,a){if(a._editable!=true){a.removeClassName("dataGridCellViewerDisabled")}else{this._removeDisabledHiddenElement(a)}a.disabled=false},getEditorValue:function($super,a){if(a._editable!=true){return this._getViewerValue(a)}else{return a.value}},setEditorValue:function($super,b,a){a=this._unescapeHtmlEntities(a);if(b._editable!=true){this._setViewerValue(b,a)}else{if(this.isDisabled(b)){this._updateDisabledHiddenElement(b,a)}b.value=a}},destroyEditor:function($super,a){a.remove()},isDisabled:function($super,a){return a.disabled==true},getDataType:function($super){return"text"},getMode:function($super){return DataGridControllers.EDITMODE_EDITABLE},_onClick:function(a){var b=Event.element(a);if(!b.hasClassName("dataGridCellEditorText")&&!b.hasClassName("dataGridCellViewerText")){var c=b.up(".dataGridCellViewerText");if(c){b=c}else{var c=b.up(".dataGridCellEditorText");if(c){b=c}}}if(Object.isFunction(b._columnDefinition.onclick)){if(this.isDisabled(b)!=true){b._columnDefinition.onclick.call(window,{dataGridComponent:b._dataGrid,row:this.getEditorRow(b),column:this.getEditorColumn(b)})}}},_onEditorValueChange:function(a){var b=Event.element(a);this._fireValueChange(b,b.value)}});DataGridControllers.registerController(new TextDataGridEditorController());HiddenDataGridEditorController=Class.create(DataGridEditorController,{buildEditor:function($super,a,b){return this._createEditorElement("input",a,undefined,{type:"hidden",name:a},b)},getEditorValue:function($super,a){return a.value},setEditorValue:function($super,b,a){b.value=a==undefined?"":this._unescapeHtmlEntities(a)},destroyEditor:function($super,a){a.remove()},getDataType:function($super){return"hidden"},isDisabled:function($super,a){return a.disabled==true},getMode:function(){return DataGridControllers.EDITMODE_ONLY_EDITABLE}});DataGridControllers.registerController(new HiddenDataGridEditorController());_DataGrid_ROWSORT=Class.create({initialize:function(a,b){this._column=a;this._sortDirection=b},getColumn:function(){return this._column},getSortDirection:function(){return this._sortDirection},compare:function(a,c,b){return 0}});DataGrid_ROWSTRINGSORT=Class.create(_DataGrid_ROWSORT,{compare:function(b,g,f){var c=b.dataGridComponent;var e=new String(c.getCellValue(g,this.getColumn())).toLowerCase();var d=new String(c.getCellValue(f,this.getColumn())).toLowerCase();var a=e==d?0:e<d?-1:1;if(this.getSortDirection()=="desc"){return a*-1}return a}});DataGrid_ROWNUMBERSORT=Class.create(_DataGrid_ROWSORT,{compare:function(b,g,e){var c=b.dataGridComponent;var f=0+c.getCellValue(g,this.getColumn());var d=0+c.getCellValue(e,this.getColumn());var a=f==d?0:f<d?-1:1;if(this.getSortDirection()=="desc"){return a*-1}return a}});DataGrid_ROWSELECTSORT=Class.create(_DataGrid_ROWSORT,{compare:function(b,h,g){var d=b.dataGridComponent;var c=DataGridControllers.getController("select");var f=new String(c.getDisplayValue(d.getCellEditor(h,this.getColumn()))).toLowerCase();var e=new String(c.getDisplayValue(d.getCellEditor(g,this.getColumn()))).toLowerCase();var a=f==e?0:f<e?-1:1;if(this.getSortDirection()=="desc"){return a*-1}return a}});_DataGrid_FILTER=Class.create({initialize:function(a){this._column=a},execute:function(a){},getColumn:function(){return this._column}});_DataGrid_DATAGRIDSTRINGFILTER=Class.create(_DataGrid_FILTER,{initialize:function($super,c,d,b,a){$super(c);this._filterValue=d;this._rowFilterableFunc=b;this._inclusive=a},execute:function($super,a){var b=a.dataGridComponent;var f=this._rowFilterableFunc;var c=!(this._rowFilterableFunc==undefined);var g=new Array();for(var d=b.getRowCount()-1;d>=0;d--){var h=b.getCellValue(d,this.getColumn());var e=this._inclusive?h!=this._filterValue:h==this._filterValue;if(e){if((!c)||(f(b,d)===true)){g.push(d)}}}if(g.size()>0){b.hideRows(g.toArray())}}});DataGrid_ROWSTRINGFILTER=Class.create({initialize:function(b,a){this._rowFilterableFunc=b;if(a!=undefined){this._inclusive=a===false?false:true}else{this._inclusive=true}},execute:function(d){var a=d.dataGridComponent;var e=d.row;var c=d.column;var f=a.getCellValue(e,c);var b=new _DataGrid_DATAGRIDSTRINGFILTER(c,f,this._rowFilterableFunc,this._inclusive);a.addFilter(b)}});_DataGrid_DATAGRIDDATEFILTER=Class.create(_DataGrid_FILTER,{initialize:function($super,c,d,b,a){$super(c);this._filterValue=d;this._filterEarlier=b;this._rowFilterableFunc=a},execute:function($super,e){var b=e.dataGridComponent;var f=this._rowFilterableFunc;var g=!((f==undefined)||(f==null));var a=new Array();if(this._filterEarlier){for(var d=b.getRowCount()-1;d>=0;d--){var c=b.getCellValue(d,this.getColumn());if((c)&&(c>this._filterValue)){if((!g)||(f(b,d)===true)){a.push(d)}}}}else{for(var d=b.getRowCount()-1;d>=0;d--){var c=b.getCellValue(d,this.getColumn());if((c)&&(c<this._filterValue)){if((!g)||(f(b,d)===true)){a.push(d)}}}}if(a.size()>0){b.hideRows(a.toArray())}}});DataGrid_ROWDATEFILTER=Class.create({initialize:function(b,a){this._filterEarlier=b;this._rowFilterableFunc=a},execute:function(d){var a=d.dataGridComponent;var e=d.row;var c=d.column;var f=a.getCellValue(e,c);var b=new _DataGrid_DATAGRIDDATEFILTER(c,f,this._filterEarlier,this._rowFilterableFunc);a.addFilter(b)}});DataGrid_ROWCLEARFILTER=Class.create({initialize:function(){},execute:function(b){var a=b.dataGridComponent;a.clearFilters()}});DataGrid_COPYVALUESTOCOLUMNACTION=Class.create({initialize:function(a){this._onlyModifiable=a},execute:function(a){var b=a.dataGridComponent;var c=a.column;var l=a.row;var j=b.getCellEditor(l,c);var f=DataGridControllers.getController(b.getCellEditor(l,c)._dataType);for(var e=0,g=b.getRowCount();e<g;e++){if(e!=l){var d=b.getCellEditor(e,c);var h=this._onlyModifiable?f.getEditable(d):true;if(h){f.copyCellValue(d,j)}}}}});