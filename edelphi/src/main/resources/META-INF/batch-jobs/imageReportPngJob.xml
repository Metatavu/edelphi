<job id="imageReportPngJob" xmlns="http://xmlns.jcp.org/xml/ns/javaee" version="1.0">
  
  <listeners>
    <listener ref="reportStatusListener" />
  </listeners>
  
  <properties>
    <property name="queryId" value="#{jobParameters['queryId']}" />
    <property name="pageIds" value="#{jobParameters['pageIds']}" />
    <property name="stampId" value="#{jobParameters['stampId']}" />
    <property name="baseUrl" value="#{jobParameters['baseUrl']}" />
    <property name="locale" value="#{jobParameters['locale']}" />
    <property name="deliveryEmail" value="#{jobParameters['deliveryEmail']}" />
    <property name="expertiseGroupIds" value="#{jobParameters['expertiseGroupIds']}" />
    <property name="panelUserGroupIds" value="#{jobParameters['panelUserGroupIds']}" />
    <property name="queryReplyIds" value="#{jobParameters['queryReplyIds']}" />
  </properties>
        
  <step id="pages" next="zip">
    <chunk item-count="2">
      <reader ref="queryPageReader"/>
      <writer ref="imageReportChartWriter"/>
    </chunk>
  </step>
        
  <step id="zip" next="email">
    <chunk item-count="2">
      <reader ref="binaryFileReader"/>
      <writer ref="zipWriter"/>
    </chunk>
  </step>

  <step id="email">
    <properties>
      <property name="emailSubjectLocale" value="reports.imagePng.mail.subject"/>
      <property name="emailContentLocale" value="reports.imagePng.mail.content"/>
    </properties>
    
    <batchlet ref="fileSenderBatchlet"/>
  </step>

</job> 